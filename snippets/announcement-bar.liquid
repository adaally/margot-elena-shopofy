{%- assign show_announcement = false -%}
{%- assign announcement_block_count = 0 -%}
{%- for block in section.blocks -%}
  {%- if block.type == 'announcement' or block.type == '@app' -%}
    {%- assign show_announcement = true -%}
    {%- assign announcement_block_count = announcement_block_count | plus: 1 -%}
  {%- endif -%}
{%- endfor -%}

{% if show_announcement %}
  <div class="announcement-bar">
    <div class="page-width">
      <div class="slideshow-wrapper" style="display: flex;">
        {%- if announcement_block_count > 1 -%}
          <span class="arrow" id="toggleCollapseBtn" role="button" tabindex="0" aria-label="Hide announcement slider"></span>
        {%- endif  -%}
        <div
          id="AnnouncementSlider"
          class="announcement-slider show" style="width: 100%;"
          data-compact="{{ section.settings.announcement_compact }}"
          data-block-count="{{ announcement_block_count }}">
          {%- assign slide_index = 0 -%}
          {%- for block in section.blocks -%}
            {%- if block.type == '@app' -%}
              <div
                id="AnnouncementSlide-{{ block.id }}"
                class="announcement-slider__slide"
                data-index="{{ slide_index }}"
                {{ block.shopify_attributes }}
              >
                {%- render block -%}
              </div>
              {%- assign slide_index = slide_index | plus: 1 -%}
            {%- endif -%}
            {%- if block.type == 'announcement' -%}
              <div
                id="AnnouncementSlide-{{ block.id }}"
                class="announcement-slider__slide"
                data-index="{{ slide_index }}"
                {{ block.shopify_attributes }}
              >
                {%- if block.settings.link != blank -%}
                  <a class="announcement-link" href="{{ block.settings.link }}">
                {%- endif -%}
                  {%- if block.settings.text != blank -%}
                    <span class="announcement-text">{{ block.settings.text }}</span>
                  {%- endif -%}
                  {%- if block.settings.link_text != blank -%}
                    <span class="announcement-link-text">{{ block.settings.link_text }}</span>
                  {%- endif -%}
                {%- if block.settings.link != blank -%}
                  </a>
                {%- endif -%}
              </div>
              {%- assign slide_index = slide_index | plus: 1 -%}
            {%- endif -%}
          {%- endfor -%}
        </div>
        <button class="btn--play-pause play_show" aria-label="Pause announcement slider">
            <svg class="icon--play" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
            <svg class="icon--pause" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="currentColor" stroke-linecap="round" stroke-linejoin="round"><rect x="7" y="4" width="2" height="16"></rect><rect x="15" y="4" width="2" height="16"></rect></svg>
        </button>
      </div>
    </div>
  </div>

{% endif %}

<style>
  .announcement-link {
    outline-offset: -2px;
  }
  .btn--play-pause {
    display: flex;
    align-items: center;
    background: transparent;
    justify-content: center;
    border: none;
    padding: 3px;
    cursor: pointer;
    width: 20px;
    height: 20px;
    border-radius: 100%;
    border: 1px solid #000000;
  }

  .btn--play-pause .icon--pause {
  display: inline-block;
  }
  .btn--play-pause .icon--play {
    display: none;
  }

  .btn--play-pause.is-paused .icon--pause {
    display: none;
  }
  .btn--play-pause.is-paused .icon--play {
    display: inline-block;
  }

  .arrow {
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 10px solid #333;
    transition: transform 0.3s ease;
    margin-top: 5px;
    outline-offset: 5px;
    cursor: pointer;
  }

  .arrow.up {
    transform: rotate(180deg);
  }

  .show {
    display: block;
  }


  #AnnouncementSlider, .btn--play-pause {
    display: none;
  }
  .play_show {
    display: flex;
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const btn = document.querySelector("#toggleCollapseBtn");
    const container = document.querySelector("#AnnouncementSlider");
    const btnPauseToggle = document.querySelector('.btn--play-pause');
    btn.addEventListener('click', () => {
      container.classList.toggle("show");
      btnPauseToggle.classList.toggle("play_show");
      btn.classList.toggle("up");
      const toggleText = container.classList.contains("show") ? "Hide" : "Show"
      btn.setAttribute("aria-label", toggleText + " announcement slider");
    });
  });
</script>